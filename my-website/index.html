<!-- Inside the <script> tag of home.js (or wherever you keep JS) -->
---------- CONFIG ----------
const API_KEY = "742aa17a327005b91fb6602054523286";
const BASE_URL = "https://api.themoviedb.org/3";
const IMG_URL = "https://image.tmdb.org/t/p/original";

---------- SERVER MAP ----------
const VIDEO_SERVERS = [
  { name: "vidsrc.cc", embedPrefix: "https://vidsrc.cc/v2/embed/" },
  { name: "vsrc.su",    embedPrefix: "https://vsrc.su/embed/" },
  { name: "player.videasy.net", embedPrefix: "https://player.videasy.net/" }
];

 ---------- CONNECTION PROFILE ----------
function getConnectionProfile() {
  const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  if (!conn) return { server: VIDEO_SERVERS[0].name };

  if (conn.saveData) return { server: VIDEO_SERVERS[2].name };
  switch (conn.effectiveType) {
    case "slow-2g":
    case "2g": return { server: VIDEO_SERVERS[2].name };
    case "3g":   return { server: VIDEO_SERVERS[1].name };
    default:     return { server: VIDEO_SERVERS[0].name };
  }
}

---------- BUILD EMBED URL ----------
function buildEmbedUrl(item) {
  const type   = item.media_type === "movie" ? "movie" : "tv";
  const server = getConnectionProfile().server;
  const prefix = VIDEO_SERVERS.find(s => s.name === server)?.embedPrefix
               || "https://vidsrc.cc/v2/embed/";

  return `${prefix}${type}/${item.id}`;
}

 ---------- AUTO SERVER CHANGE ----------
async function changeServerAutomatically(item) {
  const embedUrl = buildEmbedUrl(item);
  document.getElementById("modal-video").src = embedUrl;

   optional: keep the selector in sync
  document.getElementById("server").value = serverFromServerList(VIDEO_SERVERS, embedUrl);
}

function serverFromServerList(list, embedUrl) {
  for (const s of list) {
    if (embedUrl.startsWith(s.embedPrefix)) return s.name;
  }
  return list[0].name;
}

 ---------- DISPLAY LIST ----------
function displayList(items, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  items.forEach((item, i) => {
    const img = document.createElement("img");
    img.src = `${IMG_URL}${item.poster_path}`;
    img.alt = item.title || item.name;
    img.loading = "lazy";
    img.style.animationDelay = `${i * 40}ms`;
    img.classList.add("poster-item");

    img.onclick = async () => {
      await showDetails(item);
      await changeServerAutomatically(item); // <-- NEW
    };
    container.appendChild(img);
  });
}

// The rest of your existing functions (showDetails, closeModal, etc.) stay unchanged.
